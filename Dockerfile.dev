# Backend Dockerfile for Development (with hot reload)
# Using node:20-slim instead of alpine to avoid DNS issues
FROM node:20-slim

# Set working directory
WORKDIR /app

# Install build dependencies for native modules (bcrypt, argon2)
# Note: slim uses apt instead of apk
RUN apt-get update && apt-get install -y \
    python3 \
    make \
    g++ \
    && rm -rf /var/lib/apt/lists/* 

# Copy package files
COPY package*.json ./
COPY server/package*.json ./server/

# Install ALL dependencies (including devDependencies for nodemon)
# Use npm install in dev to auto-update lock file if needed
RUN npm install

# Install server dependencies
WORKDIR /app/server
# Use npm install in dev to auto-update lock file if needed
RUN npm install

# Go back to app root
WORKDIR /app

# Create uploads directory
RUN mkdir -p server/uploads

# Expose port
EXPOSE 5000

# Set environment variables
ENV NODE_ENV=development
ENV PORT=5000

# Start the server with nodemon for hot reload
WORKDIR /app/server
CMD ["npm", "run", "dev"]

